# Network Vulnerability Assessment con Nmap NSE

---

## 1 Introduzione e Scenario

In questo progetto ho simulato uno scenario di attacco interno in un ambiente virtualizzato. L'obiettivo era identificare vulnerabilità critiche su una macchina target (Vittima) agendo da una macchina attaccante, utilizzando esclusivamente strumenti a riga di comando open source.

L'approccio scelto è quello del Vulnerability Scanning attivo tramite Nmap Scripting Engine (NSE).

### Architettura del Laboratorio

- Macchina Attaccante: Linux (IP: `10.0.2.X` - es. Kali Linux)
- Macchina Vittima: Windows 10 Enterprise/Pro (IP: `10.0.2.3`)
- Rete: NAT Network (VirtualBox) - Le macchine sono nella stessa sottorete isolata.

---

## 2 Teoria: Nmap e NSE

### Cos'è Nmap?

Nmap è lo standard industriale per la scansione di rete. Di base, invia pacchetti alla vittima per determinare quali porte sono aperte e quali servizi sono in ascolto.

### Cos'è NSE (Nmap Scripting Engine)?

È la funzionalità che trasforma Nmap da semplice scanner di porte a potente strumento di audit. Gli script NSE (scritti in Lua) permettono di:
- Rilevare versioni avanzate dei servizi.
- Effettuare brute-force delle password.
- Rilevare vulnerabilità note (CVE): Utilizzando la categoria `vuln`, Nmap interroga i servizi per vedere se rispondono come software non patchati o vulnerabili.

### Differenza Operativa: Nmap Standard vs Nmap + NSE
Per il progetto è fondamentale comprendere questa distinzione:
- Senza NSE (Standard): Nmap lavora a livello di trasporto. Bussa alla porta (es. 445) e ti dice "Aperta". Non sa se il servizio dietro è sicuro o vecchio. È "cieco" sulle vulnerabilità.
- Con NSE: Nmap lavora a livello applicativo. Non si limita a bussare, ma "entra" ed esegue comandi specifici per interrogare il servizio ("Sei patchato?"). È l'NSE che trasforma la mappatura di rete in un vero Vulnerability Assessment.

---

## 3 Esecuzione del Test

### Fase 1: Discovery e Port Scanning
Il primo passo è stato verificare la visibilità dell'host e trovare le porte aperte.

Comando eseguito:

```Bash
nmap -Pn -sV -O 10.0.2.3
```

Spiegazione flag:

- `-Pn`: Tratta l'host come online (fondamentale se il firewall di Windows blocca il Ping).
- `-sV`: Service Version Detection (cerca di capire la versione esatta del software, es. "Apache 2.4.49").
- `-O`: OS Detection (tenta di indovinare il sistema operativo).

Risultato: L'output ha mostrato le porte critiche aperte, in particolare la 445/tcp (microsoft-ds) e la 139/tcp (netbios-ssn).

![](./img/Screenshot_2026-01-31_18_49_10%20(Edited3).jpg)

### Fase 2: Analisi Specifica della Configurazione SMB

Prima di lanciare la scansione completa delle vulnerabilità, ho effettuato un controllo mirato sulla configurazione del protocollo SMB per verificarne la modalità di sicurezza (es. Message Signing).

Comando eseguito:

```Bash
nmap -p 445 --script smb-security-mode 10.0.2.3
```

Risultato: Questo script permette di capire rapidamente la postura di sicurezza del servizio file sharing senza dover attendere una scansione completa.

![](./img/Screenshot_2026-01-31_18_49_10%20(Edited1).jpg)

### Fase 3: Vulnerability Scanning con NSE

Una volta identificate le porte, ho lanciato gli script di vulnerabilità automatizzati.

Comando eseguito:

```Bash
nmap --script vuln -p 445,139 10.0.2.3
```

Analisi del comando:

- `--script vuln`: Esegue un set completo di script progettati per trovare vulnerabilità note (es. smb-vuln-ms17-010).
- `-p 445,139`: Ho limitato la scansione alle porte SMB per velocizzare il processo e ridurre il "rumore" di rete, focalizzandomi sul vettore di attacco più probabile su Windows.

Risultato della scansione: Nmap ha interrogato il servizio SMB.

![](./img/Screenshot_2026-01-31_18_49_10%20(Edited2).jpg)

(Nota: Se la macchina è vulnerabile, qui appariranno codici come CVE-2017-0143. Se è patchata, Nmap potrebbe non restituire nulla o dire che il sistema è pulito).

---

## 4 Esperienza Personale e Troubleshooting (Logbook)

Durante l'esecuzione del progetto ho riscontrato e risolto le seguenti problematiche:

### Problema 1: "Host seems down"

- Sintomo: Lanciando un semplice `nmap 10.0.2.3`, Nmap rispondeva che l'host era giù, anche se la VM era accesa.
- Causa: Il Firewall di Windows (Windows Defender Firewall) blocca di default le richieste ICMP (Ping) in entrata.
- Soluzione: Ho utilizzato il flag `-Pn` (No Ping). Questo forza Nmap a scansionare le porte anche se l'host non risponde al ping iniziale.

### Problema 2: Tempi di scansione lunghi

- Sintomo: Il comando `--script vuln` lanciato su tutte le porte (`-p-`) impiegava troppo tempo (oltre 15 minuti).
- Causa: Gli script di vulnerabilità sono pesanti; eseguirli su 65535 porte è inefficiente.
- Soluzione Ottimizzata: Ho prima fatto una scansione veloce per trovare le porte aperte, e poi ho lanciato lo script `vuln` solo sulle porte interessanti (445 e 139), riducendo il tempo a meno di 1 minuto.

### Problema 3: Falsi Negativi

- Riflessione: Ho notato che Nmap è ottimo per vulnerabilità note e vecchie (come EternalBlue), ma meno efficace di tool dedicati (come Nessus o OpenVAS) per le vulnerabilità recenti o complesse che richiedono autenticazione.
- Lesson Learned: Nmap è eccellente per una verifica rapida "da fuori" (Black Box), ma per un audit completo è necessario combinare più strumenti.

---

## 5 Conclusioni

L'utilizzo di nmap-nse ha permesso di identificare potenziali vettori di attacco senza installare agenti sulla macchina vittima. Questo progetto dimostra la capacità di utilizzare strumenti CLI standard per valutare la postura di sicurezza di un endpoint Windows in rete.